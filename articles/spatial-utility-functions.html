<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spatial Utility Functions â€¢ RWmisc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Spatial Utility Functions">
<meta property="og:description" content="RWmisc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RWmisc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/spatial-utility-functions.html">Spatial Utility Functions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jayrobwilliams/RWmisc/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="spatial-utility-functions_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Spatial Utility Functions</h1>
                        <h4 class="author">Rob Williams</h4>
            
            <h4 class="date">2021-02-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jayrobwilliams/RWmisc/blob/master/vignettes/spatial-utility-functions.Rmd"><code>vignettes/spatial-utility-functions.Rmd</code></a></small>
      <div class="hidden name"><code>spatial-utility-functions.Rmd</code></div>

    </div>

    
    
<p>This package contains convenience functions for carrying out GIS operations that I have repeatedly encountered in my research. The following packages are used in this vignette:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jayrobwilliams/RWmisc">RWmisc</a></span><span class="op">)</span></code></pre></div>
<div id="weighting-raster-values-by-overlapping-polygons" class="section level1">
<h1 class="hasAnchor">
<a href="#weighting-raster-values-by-overlapping-polygons" class="anchor"></a>Weighting raster values by overlapping polygons</h1>
<p>The <code>overlap.weight</code> function allows you to weight the values of a raster cell by the inverse of the number of polygons that overlap the cell. This is useful when, e.g., calculating the population of ethnic group settlement areas when different group settlement areas can overlap one another. The <code>count</code> argument allows the count of overlapping polygons to be returned instead of the weighted cell values. Note that this converts any cells not covered by at least one polygon to <code>NA</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## create three overlapping squares</span>
<span class="va">polys_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">6</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">6</span><span class="op">)</span>,
                                             <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
                       <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>,<span class="fl">8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span><span class="op">)</span>,
                                             <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>,<span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
                       <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">7</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">7</span><span class="op">)</span>,
                                             <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
                  crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span>

<span class="co">## create raster</span>
<span class="va">raster_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span>nrows <span class="op">=</span> <span class="fl">6</span>, ncols <span class="op">=</span> <span class="fl">6</span>, xmn <span class="op">=</span> <span class="fl">2</span>, xmx <span class="op">=</span> <span class="fl">8</span>, ymn <span class="op">=</span> <span class="fl">2</span>, ymx <span class="op">=</span> <span class="fl">8</span>,
                   vals <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">36</span>, crs <span class="op">=</span> <span class="fu">CRS</span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">polys_t</span><span class="op">)</span><span class="op">$</span><span class="va">proj4string</span><span class="op">)</span><span class="op">)</span>

<span class="co">## set plotting parameters</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>

<span class="co">## plot raw raster values</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">raster_t</span>, main <span class="op">=</span> <span class="st">'raw'</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">polys_t</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">## plot count of overlapping polygons</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/overlap.weight.html">overlap.weight</a></span><span class="op">(</span><span class="va">raster_t</span>, <span class="va">polys_t</span>, count <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">polys_t</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">## plot overlap-weighted raster values</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/overlap.weight.html">overlap.weight</a></span><span class="op">(</span><span class="va">raster_t</span>, <span class="va">polys_t</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"weighted"</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">polys_t</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="spatial-utility-functions_files/figure-html/overlap-weight-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="projecting-spatial-objects-to-utm" class="section level1">
<h1 class="hasAnchor">
<a href="#projecting-spatial-objects-to-utm" class="anchor"></a>Projecting spatial objects to UTM</h1>
<p>The <code>projectUTM</code> function converts any <code>sf</code> or <code>sfc</code> objects in longitude, latitude decimal degrees to the UTM zone where the majority of the data lie. This function accounts for North and South UTM zones as well.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## read in North Carolina shapefile</span>
<span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"shape/nc.shp"</span>, package<span class="op">=</span><span class="st">"sf"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Reading layer `nc' from data source `/Users/runner/work/_temp/Library/sf/shape/nc.shp' using driver `ESRI Shapefile'</span>
<span class="co">#&gt; Simple feature collection with 100 features and 14 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965</span>
<span class="co">#&gt; geographic CRS: NAD27</span>

<span class="co">## transform crs to WGS84 and inspect CRS</span>
<span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">nc</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span>
<span class="co">#&gt; Coordinate Reference System:</span>
<span class="co">#&gt;   User input: EPSG:4326 </span>
<span class="co">#&gt;   wkt:</span>
<span class="co">#&gt; GEOGCRS["WGS 84",</span>
<span class="co">#&gt;     DATUM["World Geodetic System 1984",</span>
<span class="co">#&gt;         ELLIPSOID["WGS 84",6378137,298.257223563,</span>
<span class="co">#&gt;             LENGTHUNIT["metre",1]]],</span>
<span class="co">#&gt;     PRIMEM["Greenwich",0,</span>
<span class="co">#&gt;         ANGLEUNIT["degree",0.0174532925199433]],</span>
<span class="co">#&gt;     CS[ellipsoidal,2],</span>
<span class="co">#&gt;         AXIS["geodetic latitude (Lat)",north,</span>
<span class="co">#&gt;             ORDER[1],</span>
<span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433]],</span>
<span class="co">#&gt;         AXIS["geodetic longitude (Lon)",east,</span>
<span class="co">#&gt;             ORDER[2],</span>
<span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433]],</span>
<span class="co">#&gt;     USAGE[</span>
<span class="co">#&gt;         SCOPE["unknown"],</span>
<span class="co">#&gt;         AREA["World"],</span>
<span class="co">#&gt;         BBOX[-90,-180,90,180]],</span>
<span class="co">#&gt;     ID["EPSG",4326]]</span>

<span class="co">## project to UTM and inspect CRS</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="fu"><a href="../reference/projectUTM.html">projectUTM</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Coordinate Reference System:</span>
<span class="co">#&gt;   User input: +proj=utm +zone=17 </span>
<span class="co">#&gt;   wkt:</span>
<span class="co">#&gt; PROJCRS["unknown",</span>
<span class="co">#&gt;     BASEGEOGCRS["unknown",</span>
<span class="co">#&gt;         DATUM["World Geodetic System 1984",</span>
<span class="co">#&gt;             ELLIPSOID["WGS 84",6378137,298.257223563,</span>
<span class="co">#&gt;                 LENGTHUNIT["metre",1]],</span>
<span class="co">#&gt;             ID["EPSG",6326]],</span>
<span class="co">#&gt;         PRIMEM["Greenwich",0,</span>
<span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433],</span>
<span class="co">#&gt;             ID["EPSG",8901]]],</span>
<span class="co">#&gt;     CONVERSION["UTM zone 17N",</span>
<span class="co">#&gt;         METHOD["Transverse Mercator",</span>
<span class="co">#&gt;             ID["EPSG",9807]],</span>
<span class="co">#&gt;         PARAMETER["Latitude of natural origin",0,</span>
<span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433],</span>
<span class="co">#&gt;             ID["EPSG",8801]],</span>
<span class="co">#&gt;         PARAMETER["Longitude of natural origin",-81,</span>
<span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433],</span>
<span class="co">#&gt;             ID["EPSG",8802]],</span>
<span class="co">#&gt;         PARAMETER["Scale factor at natural origin",0.9996,</span>
<span class="co">#&gt;             SCALEUNIT["unity",1],</span>
<span class="co">#&gt;             ID["EPSG",8805]],</span>
<span class="co">#&gt;         PARAMETER["False easting",500000,</span>
<span class="co">#&gt;             LENGTHUNIT["metre",1],</span>
<span class="co">#&gt;             ID["EPSG",8806]],</span>
<span class="co">#&gt;         PARAMETER["False northing",0,</span>
<span class="co">#&gt;             LENGTHUNIT["metre",1],</span>
<span class="co">#&gt;             ID["EPSG",8807]],</span>
<span class="co">#&gt;         ID["EPSG",16017]],</span>
<span class="co">#&gt;     CS[Cartesian,2],</span>
<span class="co">#&gt;         AXIS["(E)",east,</span>
<span class="co">#&gt;             ORDER[1],</span>
<span class="co">#&gt;             LENGTHUNIT["metre",1,</span>
<span class="co">#&gt;                 ID["EPSG",9001]]],</span>
<span class="co">#&gt;         AXIS["(N)",north,</span>
<span class="co">#&gt;             ORDER[2],</span>
<span class="co">#&gt;             LENGTHUNIT["metre",1,</span>
<span class="co">#&gt;                 ID["EPSG",9001]]]]</span></code></pre></div>
<p>Projection of the North Carolina polygons can be further seen by plotting them.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## set plotting parameters</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>

<span class="co">## plot WGS84 and UTM projected North Carolina</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">nc</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/projectUTM.html">projectUTM</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span></code></pre></div>
<p><img src="spatial-utility-functions_files/figure-html/projectUTM-plot-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="maximum-and-minimum-distance-from-points-to-a-polygon" class="section level1">
<h1 class="hasAnchor">
<a href="#maximum-and-minimum-distance-from-points-to-a-polygon" class="anchor"></a>Maximum and minimum distance from point(s) to a polygon</h1>
<p>The <code>point.poly.dist</code> function computes the maximum or minimum distance from a point or set of points to a polygon. It correctly calculates distances for both geographic and projected data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## create north carolina centroids</span>
<span class="va">nc_centroids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span>
<span class="co">#&gt; Warning in st_centroid.sf(nc): st_centroid assumes attributes are constant over</span>
<span class="co">#&gt; geometries of x</span>
<span class="co">#&gt; Warning in st_centroid.sfc(st_geometry(x), of_largest_polygon =</span>
<span class="co">#&gt; of_largest_polygon): st_centroid does not give correct centroids for longitude/</span>
<span class="co">#&gt; latitude data</span>

<span class="co">## calculate maximum distance</span>
<span class="fu"><a href="../reference/point.poly.dist.html">point.poly.dist</a></span><span class="op">(</span><span class="va">nc_centroids</span><span class="op">[</span><span class="fl">53</span>,<span class="op">]</span><span class="op">$</span><span class="va">geometry</span>, <span class="va">nc</span><span class="op">[</span><span class="fl">53</span>,<span class="op">]</span><span class="op">$</span><span class="va">geometry</span>, max <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Loading required namespace: geosphere</span>
<span class="co">#&gt; 33561.23 [m]</span></code></pre></div>
<p>The following illustration depicts the line connecting the centroid of the polygon to the farthest point on the polygon (red) and the nearest point on the polygon (blue).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nc_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">nc</span><span class="op">[</span><span class="fl">53</span>,<span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html">st_cast</a></span><span class="op">(</span><span class="st">'POINT'</span><span class="op">)</span>

<span class="va">farthest_ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_distance</a></span><span class="op">(</span><span class="va">nc_points</span>, <span class="va">nc_centroids</span><span class="op">[</span><span class="fl">53</span>,<span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/which.minmax.html">which.max</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">farthest_point</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">nc_points</span><span class="op">[</span><span class="va">farthest_ind</span>,<span class="op">]</span><span class="op">)</span>,
                        <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">nc_centroids</span><span class="op">[</span><span class="fl">53</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">nearest_ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_distance</a></span><span class="op">(</span><span class="va">nc_points</span>, <span class="va">nc_centroids</span><span class="op">[</span><span class="fl">53</span>,<span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/which.minmax.html">which.min</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">nearest_point</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">nc_points</span><span class="op">[</span><span class="va">nearest_ind</span>,<span class="op">]</span><span class="op">)</span>,
                        <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">nc_centroids</span><span class="op">[</span><span class="fl">53</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="op">)</span>

<span class="co">## plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">nc</span><span class="op">[</span><span class="fl">53</span>,<span class="op">]</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">nc_centroids</span><span class="op">[</span><span class="fl">53</span>,<span class="op">]</span><span class="op">$</span><span class="va">geometry</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">farthest_point</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">nearest_point</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">'blue'</span><span class="op">)</span></code></pre></div>
<p><img src="spatial-utility-functions_files/figure-html/point-poly-dist-illus-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Carrying out the same calculations using built-in <code>sf</code> functions takes roughly twice as long to execute.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html">microbenchmark</a></span><span class="op">(</span>pk <span class="op">=</span> <span class="fu"><a href="../reference/point.poly.dist.html">point.poly.dist</a></span><span class="op">(</span><span class="va">nc_centroids</span><span class="op">[</span><span class="fl">53</span>,<span class="op">]</span><span class="op">$</span><span class="va">geometry</span>,
                                                    <span class="va">nc</span><span class="op">[</span><span class="fl">53</span>,<span class="op">]</span><span class="op">$</span><span class="va">geometry</span>, max <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
                               sf <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_distance</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html">st_cast</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">nc</span><span class="op">[</span><span class="fl">53</span>,<span class="op">]</span><span class="op">)</span>,
                                                        <span class="st">'POINT'</span><span class="op">)</span><span class="op">[</span><span class="va">farthest_ind</span><span class="op">]</span>,
                                                <span class="va">nc_centroids</span><span class="op">[</span><span class="fl">53</span>,<span class="op">]</span><span class="op">)</span>,
                               times <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>
<span class="co">#&gt; Unit: milliseconds</span>
<span class="co">#&gt;  expr       min        lq     mean    median        uq      max neval</span>
<span class="co">#&gt;    pk  6.180192  6.370976  6.69384  6.483332  6.656749 13.28557   100</span>
<span class="co">#&gt;    sf 11.672243 11.946050 12.55123 12.104901 12.356514 17.76061   100</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Rob Williams.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
